<ion-header>
  <ion-toolbar color="primary" class="white-text" mode="md">
    <ion-buttons slot="start">
      <ion-button (click)="onClose()" type="button" class="primary-action" size="large" color="primary" fill="solid">
        <ion-icon name="arrow-back" color="secondary"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>{{type}} {{transceiver.serialNumber}}</ion-title>
  </ion-toolbar>
</ion-header>
<ion-content class="greyBackground">
  <ion-refresher (ionRefresh)="doRefresh($event)" slot="fixed">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>
  <ion-row *ngIf="!data">
    <ion-col class="ion-text-center">
        <ion-spinner name="crescent" color="secondary"></ion-spinner>
    </ion-col>
  </ion-row>
  <ion-row *ngIf="data">
    <ion-col>
      <ion-row>
        <ion-button>
          <p>What buttons?</p>
        </ion-button>
        <ion-button (click)="rebootTransceiver()">
          <p>Reboot</p>
        </ion-button>
      </ion-row>
      <ion-row>
        <ion-col>
          <ion-text>
            <p>Last Transceiver Check-in: </p>
          </ion-text>
        </ion-col>
        <ion-col>
          <ion-text>
            <p *ngIf="lastTranCheckin === 'N/A'">{{lastTranCheckin}}</p>
            <p *ngIf="lastTranCheckin !== 'N/A'">{{lastTranCheckin | timeAgo}}</p>
          </ion-text>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col>
          <ion-text>
            <p class="sensor-checkin">Last Sensor Check-ins:</p>
          </ion-text>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col>
          <ion-row *ngFor="let sensor of transceiver.sensors">
            <ion-col>
              <ion-text>
                <p class="sensor-checkin">{{sensor.serialNumber}}: </p>
              </ion-text>
            </ion-col>
          </ion-row>
        </ion-col>
        <ion-col>
          <ion-row *ngFor="let date of lastCheckins">
            <ion-col>
              <ion-text>
                <p *ngIf="date === 'N/A'" class="sensor-checkin">{{date}}</p>
                <p *ngIf="date !== 'N/A'" class="sensor-checkin">{{date | timeAgo}}</p>
              </ion-text>
            </ion-col>
          </ion-row>
        </ion-col>
      </ion-row>

      <ion-row class="ion-justify-content-center">
        <ion-col size-xs="12" size-md="8" size-lg="6">
          <p class="last-updated">
            Pull screen down to refresh. Updated {{lastUpdated | dfnsFormat:'d MMM HH:mm:ss'}}
          </p>
        </ion-col>
      </ion-row>
      
      <ion-row>
        <p>Data:</p>
      </ion-row>
      <ion-row>
        <ion-col>
          <ion-list>
            <ion-card *ngFor="let entry of data; let i = index" [ngClass]="{'odd': i % 2 !== 0}" class="card">
              <ion-card-header>
                <ion-row>
                  <ion-col size="7">
                    <h2>{{serialNumberFromUniqueId(entry.topic)}}</h2>
                    <p>{{entry.date | timeAgo}}</p>
                  </ion-col>
                  <ion-col class="ion-float-right readings" size="3">
                    <h4 *ngIf="findSensorType(entry.topic) === 'vatTemp' || findSensorType(entry.topic) === 'inletTemp'" class="ion-text-right">{{(entry.data.val / 6) | number:'2.0-1'}}Â°C</h4>
                    <h4 *ngIf="findSensorType(entry.topic) === 'stirrer' && entry.data.val" class="ion-text-right">On</h4>
                    <h4 *ngIf="findSensorType(entry.topic) === 'stirrer' && !entry.data.val" class="ion-text-right">Off</h4>
                    <h4 *ngIf="findSensorType(entry.topic) === 'lidarDistance'" class="ion-text-right">{{entry.data.val}}mm</h4>
                  </ion-col>
                  <ion-col class="ion-float-right" size="2">
                    <img *ngIf="findSensorType(entry.topic)" [src]="'../../../assets/svgs/' + findSensorType(entry.topic) + '.svg'" class="icon">
                  </ion-col>
                </ion-row>
              </ion-card-header>
              <ion-card-content>
                <ion-row>
                  <ion-col>
                    <p>{{entry.topic}}</p>
                  </ion-col>
                </ion-row>
                <ion-row>
                  <ion-col>
                    <p>{{entry.date | date:'medium'}}</p>
                  </ion-col>
                </ion-row>
              </ion-card-content>
            </ion-card>
          </ion-list>
        </ion-col>
      </ion-row>
    </ion-col>
  </ion-row>
</ion-content>